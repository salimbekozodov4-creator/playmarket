<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mini App Store</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
      header { background: rgba(255,255,255,0.95); padding: 20px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center; }
      h1 { font-size: 28px; color: #333; margin: 0; }
      .container { max-width: 1000px; margin: 0 auto; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
      .card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.15); transition: transform 0.3s ease, box-shadow 0.3s ease; }
      .card:hover { transform: translateY(-8px); box-shadow: 0 15px 50px rgba(0,0,0,0.2); }
      .card-icon { width: 100%; height: 140px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; }
      .card-body { padding: 18px; }
      .card-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 8px; }
      .card-desc { font-size: 14px; color: #666; margin-bottom: 16px; line-height: 1.4; }
      .card-actions { display: flex; gap: 8px; }
      .btn { padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s ease; }
      .btn-download { background: #667eea; color: white; flex: 1; text-decoration: none; text-align: center; display: inline-block; }
      .btn-download:hover { background: #764ba2; }
      .empty { text-align: center; color: white; padding: 60px 20px; }
      .empty h2 { font-size: 32px; margin-bottom: 10px; }
      .empty p { font-size: 16px; opacity: 0.9; }
    </style>
  </head>
  <body>
    <header>
      <h1>üì± Mini App Store</h1>
    </header>
    <script>
      // If your dynamic API (server.py) is hosted separately, set its base URL here.
      // Example: const API_BASE = 'https://my-server.example.com';
      // Leave empty string to use relative paths (useful when server and web are same origin).
      const API_BASE = '';
    </script>
    <main class="container">
      <div id="apps" class="grid"></div>
      <div id="empty" class="empty" style="display:none">
        <h2>Hech qanday ilovalar topilmadi</h2>
        <p>Adminlar yangi ilovalarni qo'shishlari uchun kuting...</p>
      </div>
    </main>

    <script>
      const fileTypeIcon = (filename) => {
        if (filename.endsWith('.apk')) return 'ü§ñ';
        if (filename.endsWith('.exe')) return 'ü™ü';
        return 'üì¶';
      };

      async function loadApps(){
        try{
          const res = await fetch((API_BASE || '') + '/apps.json');
          const apps = await res.json();
          const mount = document.getElementById('apps');
          const empty = document.getElementById('empty');
          mount.innerHTML = '';
          if(!apps || apps.length===0){ empty.style.display='block'; return }
          empty.style.display='none';
          apps.forEach(a=>{
            const card = document.createElement('div'); 
            card.className='card';
            
            // Show image if available, otherwise show icon
            const imageDiv = document.createElement('div'); 
            imageDiv.className='card-icon';
            
            if(a.photo_id) {
              const img = document.createElement('img');
              img.src = (API_BASE || '') + '/photo/' + a.photo_id;
              img.style.width = '100%';
              img.style.height = '100%';
              img.style.objectFit = 'cover';
              imageDiv.appendChild(img);
            } else {
              imageDiv.textContent = fileTypeIcon(a.file_name || '');
            }
            
            const body = document.createElement('div'); 
            body.className='card-body';
            
            const title = document.createElement('h3'); 
            title.className='card-title'; 
            title.textContent = a.title || 'Untitled';
            
            const desc = document.createElement('p'); 
            desc.className='card-desc'; 
            desc.textContent = a.description || '';
            
            const actions = document.createElement('div'); 
            actions.className='card-actions';
            
            const download = document.createElement('a'); 
            download.className='btn btn-download'; 
            download.textContent = '‚¨áÔ∏è Yuklab olish';
            download.href = (API_BASE || '') + '/download/' + a.file_id;
            download.target = '_blank';
            
            actions.appendChild(download);
            body.appendChild(title);
            body.appendChild(desc);
            body.appendChild(actions);
            card.appendChild(imageDiv);
            card.appendChild(body);
            mount.appendChild(card);
          })
        }catch(e){ 
          console.error(e); 
          document.getElementById('empty').style.display='block' 
        }
      }

      loadApps();
    </script>
  </body>
</html>
