<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>App Details</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
      body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;margin:14px;background:linear-gradient(135deg,#6b8ce6 0%,#7356b8 100%);color:#222;-webkit-font-smoothing:antialiased}
      .card{background:white;max-width:900px;margin:24px auto;border-radius:12px;padding:20px}
      .top{display:flex;gap:18px;align-items:center}
      .icon{width:128px;height:128px;border-radius:20px;overflow:hidden;background:#f2f2f2;display:flex;align-items:center;justify-content:center}
      .icon img{width:100%;height:100%;object-fit:cover}
      .meta h1{margin:0;font-size:22px}
      .meta p{margin:6px 0;color:#555}
      .desc{margin-top:14px;color:#333;line-height:1.5}
      .screens{display:flex;flex-wrap:wrap;gap:10px;margin-top:18px}
      .screens img{width:260px;height:460px;object-fit:cover;border-radius:8px}
      .download{display:inline-block;margin-top:14px;padding:12px 16px;background:#3b6ce6;color:white;border-radius:12px;text-decoration:none;font-weight:700}
      .download .material-icons{vertical-align:middle;margin-right:8px}
      .back{display:inline-block;margin-top:8px;color:#666;text-decoration:underline}

      @media (max-width:600px){
        .top{flex-direction:column;align-items:flex-start}
        .icon{width:96px;height:96px}
        .screens img{width:46vw;height:82vw}
        .download{display:block;width:100%;text-align:center}
      }
    </style>
  </head>
  <body>
    <div class="card">
      <a id="back" class="back" href="index.html">← Back</a>
      <div id="content">
        <div class="top">
          <div class="icon" id="iconArea"></div>
          <div class="meta">
            <h1 id="title">Loading…</h1>
            <div id="creator" style="color:#666;margin-top:6px"></div>
            <a id="downloadBtn" class="download" href="#">⬇️ Yuklab olish</a>
          </div>
        </div>
        <div class="desc" id="desc"></div>
        <div class="screens" id="screens"></div>
      </div>
    </div>

    <script>
      // Mirror API_BASE from index.html usage
      const API_BASE = '';

      function qs(name){
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      async function loadApp(){
        const file_id = qs('file_id');
        if(!file_id){ document.getElementById('title').textContent = 'Invalid app'; return }
        try{
          const res = await fetch((API_BASE || '') + '/apps.json');
          const apps = await res.json();
          const app = apps.find(a=>a.file_id === file_id);
          if(!app){ document.getElementById('title').textContent = 'App not found'; return }

          // icon
          const iconArea = document.getElementById('iconArea');
          if(app.icon_id){
            const img = document.createElement('img');
            img.src = (API_BASE || '') + '/photo/' + app.icon_id;
            iconArea.appendChild(img);
          } else {
            const span = document.createElement('span');
            span.className = 'material-icons';
            span.style.fontSize = '48px';
            span.style.color = '#666';
            span.textContent = (app.file_name && app.file_name.endsWith('.apk')) ? 'android' : 'apps';
            iconArea.appendChild(span);
          }

          document.getElementById('title').textContent = app.title || 'Untitled';
          document.getElementById('creator').textContent = app.creator ? ('By ' + app.creator) : '';
          document.getElementById('desc').textContent = app.description || '';

          const dl = document.getElementById('downloadBtn');
          dl.href = (API_BASE || '') + '/download/' + app.file_id;
          dl.target = '_blank';
          dl.innerHTML = '<span class="material-icons">file_download</span> Yuklab olish';

          const screens = document.getElementById('screens');
          (app.screenshots || []).forEach(sid=>{
            const s = document.createElement('img');
            s.src = (API_BASE || '') + '/photo/' + sid;
            screens.appendChild(s);
          })

        }catch(e){
          console.error(e);
          document.getElementById('title').textContent = 'Failed to load app';
        }
      }

      loadApp();
    </script>
  </body>
</html>
